### 模板开发及上线说明
#### 游戏架构总览
![](https://github.com/GuangZhouShanyouGame/24haowan-open/blob/master/%E6%B8%B8%E6%88%8F%E9%A1%B5%E9%9D%A2%E5%85%B3%E7%B3%BB%E8%AF%B4%E6%98%8E.png)     
说明：
- 平台使用的是通用的layout，然后把游戏页面内容include进来
- 平台自带会引入一系列的JS和CSS的库
- 如果你想知道更详细的页面结构，可以看[这里](https://github.com/GuangZhouShanyouGame/24haowan_front_game/blob/master/24haowan/protected/views/layouts/game_tpl.php)     

#### 1. 本地开发
说明：本地开发只包含开发游戏逻辑，不包含接入平台接口。脚手架中注释带“测试用”的代码块在上线前需注释或删除，注释带“上线用”的代码块在上线前请启用。   
    
基于平台提供的脚手架来开发：  
- [Phaser脚手架](https://github.com/GuangZhouShanyouGame/24haowan-open/blob/master/%E8%84%9A%E6%89%8B%E6%9E%B6/score-phaser/main.js)
- [DOM脚手架](https://github.com/GuangZhouShanyouGame/24haowan-open/blob/master/%E8%84%9A%E6%89%8B%E6%9E%B6/score-dom/main.js)    

#### 2. 编写配置表
参考以往游戏配置表：[配置表-小恐龙快闪](https://github.com/GuangZhouShanyouGame/24haowan_front_game_tpl/blob/master/24haowan/assets/skip.json)    
     
查看配置表详细说明：[配置表详细说明](https://github.com/GuangZhouShanyouGame/24haowan-open/blob/master/%E9%85%8D%E7%BD%AE%E8%A1%A8%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E.md)   

#### 3. 接入平台接口
主要操作为将脚手架中注释带“测试用”的代码块注释或删除，注释带“上线用”的代码块启用。（目前脚手架还没升级到最新，需要维护）     
此阶段接口在本地无法测试，需要部署到平台后才可在内网测试。   

主要调用接口：
- hwsdk.showStartPage 显示开始页
- hwsdk.hideStartPage 隐藏开始页
- hwsdk.requestGameScore 提交分数
- hwsdk.requestLottery 抽奖
- hwsdk.setWxShare 设置微信分享参数
- ……

如果想要了解更多关于如何调用接口，请查看[HWSDK文档-内网（最新）](http://ljq.24haowan.i.shanyougame.com/docs/output/)    
如有特殊需求，需要自定义开始页、结束页等，请查看[如何自定义通用界面](https://github.com/GuangZhouShanyouGame/24haowan-open/blob/master/%E5%A6%82%E4%BD%95%E8%87%AA%E5%AE%9A%E4%B9%89%E9%80%9A%E7%94%A8%E7%95%8C%E9%9D%A2.md)    

#### 4. 向24haowan平台申请一个游戏模版ID

#### 5. 上传与资源
##### 代码结构如下
```
└── game_name_24            // 代码目录(强制命名方式：游戏名_模板ID, 游戏名必须全部英文小写，以"_"分隔)
    ├── static_resource     // 资源文件目录(强制命名)
    │   ├── js              // js代码目录(非强制命名)
    │   │   └── xxx.js
    │   │   └── ...
    │   ├── css             // css代码目录(非强制命名)
    │   │   └── xxx.js
    │   │   └── ...
    │   ├── ...
    ├── index.php           // 游戏页面文件(游戏的入口文件, 强制命名)
    └── index.json          // 游戏配置表(强制命名)
```

- 代码上传的github库为：24haowan_game_tpl
- index.josn配置表中，除了游戏相关的新信息，还需增加一个db_info字段, 具体内容如下:
```
    "db_info" : {
        "name" : "游戏模板名称",                        // 游戏模板名称，必填
        "describe" : "游戏描述",                        // 游戏描述，必填
        "type" : 5,                                     // 游戏类型，必填
        "lable" : "生成|测试",                          // 游戏标签，必填
        "game_img" : "/static_resource/img/index.png"   // 游戏横幅，必填
    }
```
- [完整的配置文件实例](http://24haowan-cdn.shanyougame.com/24haowan/24haowan_test/assets/game_100/index.json)

##### 资源文件访问路径 
- 资源文件访问路径: `/static_resource/...`
- 注意：代码中的变量名、函数名等非资源地址的不允许出现 `/static_resource/`(构建工具在构建时，会全局替换`/static_resource/`，如果非资源文件地址出现该字符串，也会被替换，最终会导致代码异常)
#### 6. 发布代码
- 使用构建工具将代码更新至运行环境
- 在24haowan管理后台添加游戏模板的相关信息，并上线模板

#### 7. 编写页面文件
####新建页面文件
地址：[游戏名_模板ID]/index.php    
说明：需要在页面模板中引入main.php，主要包含一些全局变量和游戏初始化通用的操作。
####Phaser示例
说明: Phaser类游戏的DOM结构只有一个game_div，平台已提供，因此只需要引入JS即可
```php
<!-- 小恐龙快闪 分数类 Phaser -->
<?php require_once('main.php'); ?>
<script type="text/javascript" src="/static_resource/js/skip/main.js?v=<?php echo Yii::app()->params['version']; ?>"></script>
```
####DOM示例
说明：DOM类游戏的DOM结构就写在页面文件中，同时引入相应的CSS和JS
```php
<!-- 老虎机 抽奖类 DOM -->
<link rel="stylesheet" href="/static_resource/css/game/tiger.css?v=<?php echo Yii::app()->params['version']; ?>">
<div id="game_div">
    <div class="title"></div>
    <div class="pull" style="z-index: 1">
            <div class="pl"></div>
            <div class="bl"></div>
        </div>
    <div class="checkBox">
        <div class="txt">剩余抽奖次数:<span class="sp">  3</span></div>
        <div class="flash" style="top: 0.8rem"></div>
        <div class="flash" style="top: 2.7rem"></div>
        <div id="btn"></div>
        <!--游戏逻辑区-->
        <div class="num-wrap">
            <div class="num-row" id="row1">
            </div>
        </div>
    </div>
    <div id="btn-put" style="z-index:2"></div>
</div>
<?php require_once('main.php'); ?>
<script type="text/javascript" src="/static_resource/js/tiger/main.js?v=<?php echo Yii::app()->params['version']; ?>"></script>
```

#### 8. 内网测试
主要检查项:
- 模板库中是否正常显示新活动
- 模板详情信息是否正确
- 模板详情左侧默认活动是否正常运作
- 是否能创建一个活动
- 工作台是否正常渲染
- 测试地址中游戏是否正常运作
- 发布后到手机上游戏是否正常运作
- 与平台接口是否正常运作（如新接口则需要联调）

#### 9. 上线到外网
- 合并分支到master并更新到外网
- 在外网管理后台添加模板信息并上线（至此外网用户已可以定制该游戏）

#### 10. 上线完毕
